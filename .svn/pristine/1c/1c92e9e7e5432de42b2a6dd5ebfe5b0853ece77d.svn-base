'use strict';

/**
* Controller to display an actual discussion
*/
var DiscussionCtrl = ($scope, $rootScope, $window, $location, $routeParams, ForumService, SynthErrorHandler) => {
	$rootScope.activePage = 'forums';
	$scope.moduleId = $routeParams.moduleId;

	// Called when the user wishes to reply
	$scope.reply = function(messageId){
		if (messageId){
			$location.path($window.location + '/' + messageId + '/reply');
		}
		else{
			$location.path($window.location + '/reply');
		}
	};
	// Get the discussion
	ForumService
	.getDiscussion($routeParams.moduleId, $routeParams.forumId, $routeParams.discussionId)
	.then(
		// Success
		function(discussion) {
			$scope.discussion = discussion;

			ForumService
			.getForum($routeParams.moduleId, $routeParams.forumId)
			.then(
				// Success
				function(forum) {
					$rootScope.breadcrumbs = [{'name' : 'Discussions', 'url' : '#/tool/forums/' + $routeParams.moduleId},
					{'name' : forum.title, 'url' : '#/tool/forums/' + $routeParams.moduleId + '/' + $routeParams.forumId}];
				},
				SynthErrorHandler);
		},
			// Failed
			SynthErrorHandler
		);
};
DiscussionCtrl.$inject = ['$scope', '$rootScope', '$window', '$location', '$routeParams', 'ForumService', 'SynthErrorHandler'];
export default DiscussionCtrl;
