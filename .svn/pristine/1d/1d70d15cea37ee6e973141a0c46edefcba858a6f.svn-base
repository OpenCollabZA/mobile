'use strict';

/**
* Faq list controller
*/
var FaqListCtrl = ($scope, $rootScope, $routeParams, FaqService, SynthErrorHandler) => {

	$rootScope.activePage = 'faqs';
	$rootScope.breadcrumbs = [{'name' : 'FAQs'}];
	$scope.moduleId = $routeParams.moduleId;

	/**
	* Adds the boolean parent indicator to identify the parent nodes
	*
	* @param {Object} faqData
	*/
	function prepareFaqData(faqData) {
		var displayData = [];
		for (var key in faqData) {
			faqData[key].isParent = faqData[key].id === faqData[key].parentId;
			if (faqData[key].isParent) {
				displayData.push(faqData[key]);
				addChildren(faqData[key], faqData);
			}
		}
		return displayData;
	}

	/**
	* Add the children for a parent node
	*
	* This is done to get the corret diaply order for the tree table
	*
	* @param {type} parentId
	* @param {type} faqData
	* @param {type} displayData
	*/
	function addChildren(parent, faqData) {
		for (var key in faqData) {
			if (faqData[key].parentId === parent.id && faqData[key].id !== parent.id) {
				parent.children = parent.children || [];
				parent.children.push(faqData[key]);
			}
		}
	}

	// Put all the Faqs on the UI
	FaqService
	.getFaqs($routeParams.moduleId)
	.then(function(faqs) {
		$scope.faqs = prepareFaqData(faqs);
	}, SynthErrorHandler);

};
FaqListCtrl.$inject = ['$scope', '$rootScope', '$routeParams', 'FaqService', 'SynthErrorHandler'];
export default FaqListCtrl;
